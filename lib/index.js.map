{"version":3,"sources":["index.js"],"names":["Util","cx","TimePicker","props","context","defaultValue","value","begin","end","onLabelClick","bind","onConfirm","onCancel","onTimeChange","time","tiemObj","parseValue","beginObj","endObj","state","stringifyValue","closest","open","componentWillUpdate","_","nextState","isSame","setState","date","timeFormat","format","toDate","onFocus","type","target","onBlur","valueMoment","timeMoment","get","onChange","renderHiddenInput","name","render","disabled","readOnly","placeholder","labelFormat","others","className","addStates","focus","getStyleStates","build","getPartClassName","displayName","defaultProps","propTypes","string","labalFormat","oneOfType","object","childContextTypes","contextTypes"],"mappings":"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","file":"index.js","sourcesContent":["/**\n * @file melon/TimePicker\n * @author cxtom <cxtom2008@gmail.com>\n */\n\nimport React, {PropTypes} from 'react';\nimport moment from 'moment';\n\nimport InputComponent from 'melon-core/InputComponent';\nimport {create} from 'melon-core/classname/cxBuilder';\nimport * as Util from './util';\n\nimport Icon  from 'melon/Icon';\nimport Confirm from 'melon/Confirm';\nimport Panel from './timepicker/Panel';\n\nimport omit from 'lodash/omit';\n\nconst cx = create('TimePicker');\n\n/**\n * melon/TimePicker\n *\n * @extends {React.Component}\n * @class\n */\nexport default class TimePicker extends InputComponent {\n\n    /**\n     * 构造函数\n     *\n     * @public\n     * @constructor\n     * @param {*} props 属性\n     * @param {*} context 上下文\n     */\n    constructor(props, context) {\n\n        super(props, context);\n\n        const {defaultValue, value, begin, end} = props;\n\n        this.onLabelClick = this.onLabelClick.bind(this);\n        this.onConfirm = this.onConfirm.bind(this);\n        this.onCancel = this.onCancel.bind(this);\n        this.onTimeChange = this.onTimeChange.bind(this);\n\n        const time = value === void 0 ? defaultValue : value;\n\n        const tiemObj = time && this.parseValue(time);\n        const beginObj = begin && this.parseValue(begin);\n        const endObj = end && this.parseValue(end);\n\n        /**\n         * 初始状态\n         *\n         * @private\n         * @type {Object}\n         */\n        this.state = {\n\n            ...this.state,\n\n            value: this.stringifyValue(time && Util.closest(tiemObj, beginObj, endObj)),\n\n            // 缓存用户在 confirm 前的选中值\n            time: time ? this.parseValue(Util.closest(tiemObj, beginObj, endObj)) : void 0,\n\n            // 是否打开选择窗\n            open: false\n        };\n\n    }\n\n    /**\n     * react生命周期，组件将更新时触发，用于value和date的同步\n     *\n     * @param {Object} _ 属性\n     * @param {Object} nextState 状态\n     */\n    componentWillUpdate(_, nextState) {\n        const time = this.parseValue(nextState.value);\n        if (this.state.value !== nextState.value && (\n            time === void 0 || nextState.time === void 0\n            || !moment(time).isSame(nextState.time, 'minute')\n            || !moment(time).isSame(nextState.time, 'hour')\n        )) {\n            this.setState({\n                date: this.parseValue(nextState.value)\n            });\n        }\n    }\n\n    /**\n     * 格式化日期\n     *\n     * @param {Date} time 源日期对象\n     * @return {string} 格式化后的日期字符串\n     * @public\n     */\n    stringifyValue(time) {\n\n        if (typeof time === 'string' || time == null) {\n            return time;\n        }\n\n        const timeFormat = this.props.timeFormat;\n\n        return moment(time).format(timeFormat);\n    }\n\n    /**\n     * 格式化日期对象\n     *\n     * @param  {string} date 日期字符串\n     * @return {Date}        转化后的日期对象\n     * @public\n     */\n    parseValue(date) {\n\n        if (typeof date !== 'string') {\n            return date;\n        }\n\n        return moment(date, this.props.timeFormat).toDate();\n    }\n\n\n    /**\n     * 点击 label\n     *\n     * @protected\n     */\n    onLabelClick() {\n\n        this.setState({open: true});\n\n        const onFocus = this.props.onFocus;\n\n        if (onFocus)  {\n            onFocus({\n                type: 'focus',\n                target: this\n            });\n        }\n    }\n\n    /**\n     * 失去焦点时处理\n     *\n     * @protected\n     */\n    onBlur() {\n\n        const onBlur = this.props.onBlur;\n\n        if (onBlur)  {\n            onBlur({\n                type: 'blur',\n                target: this\n            });\n        }\n\n    }\n\n    /**\n     * TimePicker Dialog上点击确定按钮触发\n     *\n     * @protected\n     */\n    onConfirm() {\n\n        let {value, time} = this.state;\n\n        value = this.parseValue(value);\n\n        const valueMoment = moment(value, this.timeFormat);\n        const timeMoment = moment(time);\n\n        if (value !== '' && valueMoment.get('hour') === timeMoment.get('hour')\n            && valueMoment.get('minute') === timeMoment.get('minute')) {\n            this.setState({open: false});\n        }\n\n        this.setState({open: false}, () => {\n\n            super.onChange({\n                type: 'change',\n                target: this,\n                value: this.stringifyValue(time)\n            });\n\n            this.onBlur();\n\n        });\n\n    }\n\n    /**\n     * TimePicker Dialog上点击取消按钮触发\n     *\n     * @protected\n     */\n    onCancel() {\n        this.setState({open: false}, () => {\n            this.onBlur();\n        });\n    }\n\n\n    /**\n     * onTimeChange - description\n     *\n     * @param  {Object} param 事件对象\n     * @param  {Date} param.time 改变的时间\n     */\n    onTimeChange({time}) {\n        this.setState({time});\n    }\n\n    /**\n     * 渲染input\n     *\n     * @protected\n     * @return {ReactElement}\n     */\n    renderHiddenInput() {\n\n        const {name, value} = this.props;\n\n        return name\n            ? (\n                <input\n                    name={name}\n                    type=\"hidden\"\n                    value={value} />\n            )\n            : null;\n\n    }\n\n    /**\n     * 渲染\n     *\n     * @public\n     * @return {ReactElement}\n     */\n    render() {\n\n        const {\n            state,\n            props\n        } = this;\n\n        const {\n            disabled,\n            readOnly,\n            placeholder,\n            timeFormat,\n            labelFormat,\n            ...others\n        } = props;\n\n        let {begin, end} = props;\n\n        begin = begin ? this.parseValue(begin) : null;\n        end = end ? this.parseValue(end) : null;\n\n        const {value, open} = state;\n\n        const className = cx(props)\n            .addStates({focus: open})\n            .addStates(this.getStyleStates())\n            .build();\n\n        return (\n            <div {...omit(others, ['name'])} className={className}>\n                {this.renderHiddenInput()}\n                <label\n                    onClick={(disabled || readOnly) ? null : this.onLabelClick}\n                    className={cx.getPartClassName('label')}>\n                    {value ? moment(value, timeFormat).format(labelFormat) : (\n                        <span className={cx.getPartClassName('label-placeholder')}>\n                            {placeholder}\n                        </span>\n                    )}\n                    <Icon icon='expand-more' />\n                </label>\n                <Confirm\n                    open={open}\n                    variants={['timepicker']}\n                    onConfirm={this.onConfirm}\n                    onCancel={this.onCancel}\n                    width=\"adaptive\"\n                    buttonVariants={['secondery', 'timepicker']} >\n                    <Panel\n                        time={this.state.time}\n                        begin={begin}\n                        end={end}\n                        format={timeFormat}\n                        onChange={this.onTimeChange} />\n                </Confirm>\n            </div>\n        );\n\n    }\n}\n\nTimePicker.displayName = 'TimePicker';\n\nTimePicker.defaultProps = {\n    ...InputComponent.defaultProps,\n    timeFormat: 'HH:mm:ss',\n    labelFormat: 'HH:mm',\n    placeholder: '请选择'\n};\n\nTimePicker.propTypes = {\n    ...InputComponent.propTypes,\n    placeholder: PropTypes.string,\n    timeFormat: PropTypes.string,\n    labalFormat: PropTypes.string,\n    end: PropTypes.oneOfType([\n        PropTypes.object,\n        PropTypes.string\n    ]),\n    begin: PropTypes.oneOfType([\n        PropTypes.object,\n        PropTypes.string\n    ])\n};\n\nTimePicker.childContextTypes = InputComponent.childContextTypes;\nTimePicker.contextTypes = InputComponent.contextTypes;\n"]}