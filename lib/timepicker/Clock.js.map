{"version":3,"sources":["timepicker/Clock.js"],"names":["cx","PI","Math","atan","TimePickerClock","args","onMouseDown","bind","onMouseUp","onMouseChange","handler","clearTimeout","mouseChangeTimer","setTimeout","e","shouldComponentUpdate","nextProps","props","time","mode","begin","end","isSame","componentWillUnmount","refs","main","addEventListener","document","removeEventListener","pageX","pageY","mainPosition","radius","width","pos","x","left","y","top","deg","single","number","round","getHours","newTime","toDate","onChange","renderItems","items","map","timeMoment","selected","hour","itemHour","minute","disabled","isBefore","isAfter","render","className","addVariants","build","getPartClassName","displayName","propTypes","instanceOf","Date","oneOf","func","isRequired"],"mappings":"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","file":"Clock.js","sourcesContent":["/**\n * @file melon/TimePickerClock\n * @author cxtom(cxtom2008@qq.com)\n */\n\nimport React, {Component, PropTypes} from 'react';\nimport moment from 'moment';\n\nimport {create} from 'melon-core/classname/cxBuilder';\nimport {range} from 'melon-core/util/array';\nimport {getPosition} from 'melon/common/util/dom';\n\nimport ClockItem from './ClockItem';\nimport ClockHand from './ClockHand';\n\nconst cx = create('TimePickerClock');\nconst {\n    PI,\n    atan\n} = Math;\n\nexport default class TimePickerClock extends Component {\n\n    constructor(...args) {\n        super(...args);\n\n        this.onMouseDown = this.onMouseDown.bind(this);\n        this.onMouseUp = this.onMouseUp.bind(this);\n\n        // 限流\n        this.onMouseChange = (() => {\n\n            let handler = this.onMouseChange;\n\n            return e => {\n                clearTimeout(this.mouseChangeTimer);\n                this.mouseChangeTimer = setTimeout(handler.bind(this, e), 5);\n            };\n\n        })();\n    }\n\n    /**\n     * react 组件生命周期——判断是否需要更新组件，用来做性能优化\n     *\n     * @public\n     * @params {Object} nextProps 更新的属性\n     * @return {boolean} 是否需要更新\n     */\n    shouldComponentUpdate(nextProps) {\n\n        const {\n            time,\n            mode,\n            begin,\n            end\n        } = this.props;\n\n        return !moment(time).isSame(nextProps.time)\n            || mode !== nextProps.mode\n            || !moment(begin).isSame(nextProps.begin)\n            || !moment(end).isSame(nextProps.end);\n    }\n\n    /**\n     * react 组件生命周期——组件销毁前调用\n     *\n     * @public\n     */\n    componentWillUnmount() {\n        clearTimeout(this.mouseChangeTimer);\n        this.mouseChangeTimer = null;\n    }\n\n    onMouseDown(e) {\n\n        if (this.props.mode === 'minute') {\n            this.refs.main.addEventListener('mousemove', this.onMouseChange);\n            document.addEventListener('mouseup', this.onMouseUp);\n        }\n        else {\n            this.refs.main.addEventListener('mouseup', this.onMouseChange);\n        }\n    }\n\n    onMouseUp(e) {\n\n        if (this.props.mode === 'minute') {\n            this.onMouseChange(e);\n            this.refs.main.removeEventListener('mousemove', this.onMouseChange);\n            document.removeEventListener('mouseup', this.onMouseUp);\n        }\n        else {\n            this.refs.main.removeEventListener('mouseup', this.onMouseChange);\n        }\n    }\n\n    onMouseChange({pageX, pageY}) {\n\n        const mainPosition = getPosition(this.refs.main);\n        const radius = mainPosition.width / 2;\n\n        const pos = {\n            x: pageX - mainPosition.left - radius,\n            y: pageY - mainPosition.top - radius\n        };\n\n        let deg;\n\n        if (pos.y === 0) {\n            return;\n        }\n\n        if (pos.x >= 0 && pos.y < 0) {\n            deg = -180 * atan(pos.x / pos.y) / PI;\n        }\n        else if (pos.x >= 0 && pos.y > 0) {\n            deg = 180 - 180 * atan(pos.x / pos.y) / PI;\n        }\n        else if (pos.x < 0 && pos.y > 0) {\n            deg = 180 - 180 * atan(pos.x / pos.y) / PI;\n        }\n        else if (pos.x < 0 && pos.y < 0) {\n            deg = 360 - 180 * atan(pos.x / pos.y) / PI;\n        }\n\n        const {\n            time,\n            mode\n        } = this.props;\n\n        const single = mode === 'minute' ? 6 : 30;\n        let number = Math.round(deg / single);\n\n        if (mode === 'hour') {\n            // number为0表示选择了上午12点\n            number = number === 0 ? 12 : number;\n            // 下午的时间加12\n            number = time.getHours() > 12 ? number + 12 : number;\n            // number为24时的特殊处理，日期如果不改为0，日期会加1\n            number = number === 24 ? 0 : number;\n        }\n\n        const newTime = moment(time)[mode](number).toDate();\n\n        if (moment(newTime).isSame(time)) {\n            return;\n        }\n\n        this.props.onChange({\n            time: newTime\n        });\n\n    }\n\n    renderItems() {\n\n        const {\n            time,\n            mode,\n            begin,\n            end\n        } = this.props;\n\n        const items = mode === 'hour'\n            ? range(1, 13)\n            : range(0, 60, 5);\n\n        return items.map(number => {\n\n            let timeMoment;\n            let selected = false;\n            if (mode === 'hour') {\n                let hour = moment(time).hour();\n                hour = hour === 0 ? 12 : hour;\n                selected = (hour > 12 ? (hour - 12) : hour) === number;\n                const itemHour = hour > 12 ? (number + 12) : number;\n                timeMoment = moment(time).hour(itemHour);\n            }\n            else {\n                selected = moment(time).minute() === number;\n                timeMoment = moment(time).minute(number);\n            }\n\n            let disabled = false;\n            disabled = begin ? timeMoment.isBefore(begin) : false;\n            disabled = end ? timeMoment.isAfter(end) : false;\n\n            return (\n                <ClockItem\n                    key={mode + number}\n                    time={timeMoment.toDate()}\n                    mode={mode}\n                    selected={selected}\n                    disabled={disabled} />\n            );\n        });\n\n    }\n\n    render() {\n\n        const {\n            time,\n            mode,\n            onChange\n        } = this.props;\n\n        const className = cx(this.props)\n            .addVariants(mode)\n            .build();\n\n        return (\n            <div className={className}>\n                <div\n                    className={cx.getPartClassName('main')}\n                    ref=\"main\"\n                    onMouseDown={this.onMouseDown}>\n                    <ClockHand\n                        time={time}\n                        mode={mode}\n                        onChange={onChange} />\n                    {this.renderItems()}\n                </div>\n            </div>\n        );\n\n    }\n\n}\n\nTimePickerClock.displayName = 'TimePickerClock';\n\nTimePickerClock.propTypes = {\n    time: PropTypes.instanceOf(Date),\n    mode: PropTypes.oneOf(['hour', 'minute']),\n    begin: PropTypes.instanceOf(Date),\n    end: PropTypes.instanceOf(Date),\n    onChange: PropTypes.func.isRequired\n};\n"]}